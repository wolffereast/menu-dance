/*!
 * Menu_Dance - jQuery Plugin
 * version: 1.0.0 (Mon, 13 Oct 2014)
 * requires jQuery v1.6 or later
 *
 * wolffereast
 */

!function(t){function e(e,o){if(e=t(e),this.timeout,this.target=e,this.changers=o,this.last_scroll_top=t(window).scrollTop(),this.target_styles_initial={top:e.css("top"),display:e.css("display")},e.css({top:"0px",position:"fixed"}),t(window).on("resize",{Menu_Dance:this},this.resize_handler),this.update_element(),"[object Object]"===Object.prototype.toString.call(o))for(propt in o)t(propt).on("click",{selector:o[propt],Menu_Dance:this},this.promise_bind);return t(window).on("scroll",{last_scroll_top:this.last_scroll_top,Menu_Dance:this},this.scroll_bind),this}t.fn.menu_dance=function(o){var i,s=t.extend({},{changers:{}},o),n=this;return n.each(function(){i=t(this).data("Menu_Dance",new e(this,s.changers))}),n},e.prototype.resize_handler=function(t){clearTimeout(t.data.Menu_Dance.timeout),t.data.Menu_Dance.timeout=setTimeout(t.data.Menu_Dance.update_element(),200)},e.prototype.promise_bind=function(e){t(e.data.selector).hasClass("menuDancePromiseBound")||(t(e.data.selector).addClass("menuDancePromiseBound"),t(e.data.selector).promise().done(function(){t(e.data.selector).removeClass("menuDancePromiseBound"),e.data.Menu_Dance.update_element()}))},e.prototype.scroll_bind=function(e){var o=t(window).scrollTop(),i=e.data.Menu_Dance,s=i.target,n=i.last_scroll_top;t(".menu_dance_scrollable").length&&(n>o?("relative"==s.css("position")||0!==parseInt(s.css("top")))&&("fixed"==s.css("position")?s.css(n-o>s.height()-t(window).height()?{top:"0px"}:{position:"relative",top:n+t(window).height()-s.height()+"px"}):t(window).scrollTop()<=parseInt(s.css("top"))&&s.css({position:"fixed",top:"0px"})):o>n&&("relative"==t(s).css("position")||parseInt(t(s).css("top"))!==t(window).height()-t(s).height())&&("fixed"==t(s).css("position")?s.css(o-i.last_scroll_top>s.height()-t(window).height()?{top:t(window).height()-s.height()+"px"}:{position:"relative",top:n+"px"}):t(window).height()+t(window).scrollTop()>=s.height()+parseInt(s.css("top"))&&s.css({position:"fixed",top:t(window).height()-s.height()+"px"})),i.last_scroll_top=o)},e.prototype.destroy=function(){if(t(window).off("resize",this.resize_handler),"[object Object]"===Object.prototype.toString.call(this.changers))for(propt in this.changers)t(propt).off("click",this.promise_bind);t(window).off("scroll",this.scroll_bind),this.target.css(this.target_styles_initial),this.target.removeData("Menu_Dance")},e.prototype.update_element=function(){var e=t(window),o=this.target,i=o.height(),s=parseInt(o.css("top")),n=e.scrollTop(),a=e.height(),p=t("body").height();i>a?(o.addClass("menu_dance_scrollable"),n?"relative"==o.css("position")?n+i>p&&s+i>=p?o.animate({top:p-i+"px"},300):n+a>s+i&&o.animate({top:n+a-i+"px"},300,"swing",function(){o.css({top:t(window).height()-i+"px",position:"fixed"})}):n+i>p?o.animate({top:p-i-n+"px"},300,"swing",function(){o.css({top:p-i+"px",position:"relative"})}):a>s+i?o.animate({top:a-i+"px"},300):0!=s&&i!=s+a&&o.css({top:n+s+"px",position:"relative"}):t("div.sidebarVariableTop").css("top","0px")):(o.removeClass("menu_dance_scrollable"),"relative"==o.css("position")?o.animate({top:n+"px"},300,"swing",function(){o.css({position:"fixed",top:"0px"})}):o.css({position:"fixed",top:"0px"}))}}(jQuery);